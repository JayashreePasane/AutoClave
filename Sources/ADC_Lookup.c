/*
 * ADC_Lookup.c
 *
 *  Created on: Feb 4, 2017
 *      Author: 
 */
#include "Cpu.h"
#include "Status.h"
uint32_t Temperature_Get(void);
uint32_t Pressure_Get(void);


unsigned short pt1000[] = {
                    427,429,430,432,433,435,436,438,439,441,442,444,445,447,448,450,451,452,454,455,457,458,460,461,463,464,466, //26
		467,469,470,471,473,474,476,477,479,480,482,483,484,486,487,489,490,492,493,495,496,497,499,500,502,503,505,506,507,509, //56
		510,512,513,514,516,517,519,520,521,523,524,526,527,528,530,531,533,534,535,537,538,540,541,542,544,545,547,548,549,551, 
		552,553,555,556,558,559,560,562,563,564,566,567,568,570,571,572,574,575,577,578,579,581,582,583,585,586,587,589,590,591,
		592,593,594,595,597,598,599,601,602,603,605,606,607,609,610,611,613,614,615,616,618,619,620,622,623,624,626,627,628,630,631
};

unsigned short mpx5700[] = {62,82,102,122,142,162,182,202,222,242,262,282,302,324,342,362,382,402,422,442,462,482,502,522,542,562,582,601,621,641,661};


uint32_t Temperature_Get(void)
{
	uint32_t counter, ret_val = 0;
	uint32_t adc = Adc_Get(1);
	
	if((adc > 427) && (adc <= 631))
	{
		for(counter=0; pt1000[counter] <= adc;counter++);
		/*Value is between index counter-1 and counter
		 * x2-x1 = (pt1000[counter] - pt1000[counter-1])
		 * y2-y1 = (counter - counter-1)*100 
		 * slope = (y2-y1)/(x2-x1)
		 * slope = 100/(x2-x1)
		 * (y-y1)/(x-x1) = (y2-y1)/(x2-x1)
		 * (y-y1) = slope*(x-x1)
		 * y = slope*(x-x1)+y1
		 * temp = slope*(adc-pt1000[counter-1]) + (counter-1)*100  --->100 is for resolution*/
		ret_val = (100 * (adc-pt1000[counter-1])/(pt1000[counter] - pt1000[counter-1])) + (counter-1)*100;
	}
	
	return ret_val;
}

uint32_t Pressure_Get(void)
{
	uint32_t counter, ret_val = 0;
	uint32_t adc = Adc_Get(0);
	
	if((adc > 62) && (adc <= 661))
	{
		for(counter=0; mpx5700[counter] <= adc;counter++);
		ret_val = ((adc-mpx5700[counter-1])/(mpx5700[counter] - mpx5700[counter-1])) + (counter-1);
	}
	
	return ret_val;
}


uint32_t PT1000_Lookup[250] = 
{
		100000,	100390,	100780,	101170,	101560,	101950,	102340,	102730,	103120,	103510,
		103900,	104290,	104680,	105070,	105460,	105850,	106240,	106630,	107020,	107400,
		107790,	108180,	108570,	108960,	109350,	109730,	110120,	110510,	110900,	111290,
		111670,	112060,	112450,	112830,	113220,	113610,	114000,	114380,	114770,	115150,
		115540,	115930,	116310,	116700,	117080,	117470,	117860,	118240,	118630,	119010,
		119400,	119780,	120170,	120550,	120940,	121320,	121710,	122090,	122470,	122860,
		123240,	123630,	124010,	124390,	124780,	125160,	125540,	125930,	126310,	126690,
		127080,	127460,	127840,	128220,	128610,	128990,	129370,	129750,	130130,	130520,
		130900,	131280,	131660,	132040,	132420,	132800,	133180,	133570,	133950,	134330,
		134710,	135090,	135470,	135850,	136230,	136610,	136990,	137370,	137750,	138130,
		138510,	138880,	139260,	139640,	140020,	140400,	140780,	141160,	141540,	141910,
		142290,	142670,	143050,	143430,	143800,	144180,	144560,	144940,	145310,	145690,
		146070,	146440,	146820,	147200,	147570,	147950,	148330,	148700,	149080,	149460,
		149830,	150210,	150580,	150960,	151330,	151710,	152080,	152460,	152830,	153210,
		153580,	153960,	154330,	154710,	155080,	155460,	155830,	156200,	156580,	156950,
		157330,	157700,	158070,	158450,	158820,	159190,	159560,	159940,	160310,	160680,
		161050,	161430,	161800,	162170,	162540,	162910,	163290,	163660,	164030,	164400,
		164770,	165140,	165510,	165890,	166260,	166630,	167000,	167370,	167740,	168110,
		168480,	168850,	169220,	169590,	169960,	170330,	170700,	171070,	171430,	171800,
		172170,	172540,	172910,	173280,	173650,	174020,	174380,	174750,	175120,	175490,
		175860,	176220,	176590,	176960,	177330,	177690,	178060,	178430,	178790,	179160,
		179530,	179890,	180260,	180630,	180990,	181360,	181720,	182090,	182460,	182820,
		183190,	183550,	183920,	184280,	184650,	185010,	185380,	185740,	186110,	186470,
		186840,	187200,	187560,	187930,	188290,	188660,	189020,	189380,	189750,	190110,
		190470,	190840,	191200,	191560,	191920,	192290,	192650,	193010,	193370,	193740,
		194100,	194460,	194820,	195180,	195550,	195910,	196270,	196630,	196990,	197350
};

